(function () {
    tinymce.create('tinymce.plugins.manaoFieldInserter', {
        init: function (ed, url) {
            var injector = angular.element(document.getElementById("umbracoMainPageBody")).injector();
            var dialogService = injector.get("dialogService");

            ed.addButton('manaoFormFieldPicker', {
                title: 'Insert Form Field',
                cmd: 'mceManaoFieldInsert',
                icon: 'custom icon-autofill'
            });
            ed.addCommand('mceManaoFieldInsert', function () {
                dialogService.open({
                    template: '/umbraco/lib/tinymce/plugins/manaoFormFieldPicker/insertField.html',
                    callback: function (data) {
                        ed.insertContent(data);
                    }
                });
            });

        },
        createControl: function (n, cm) {
            return null;
        },
    });
    tinymce.PluginManager.add('manaoFormFieldPicker', tinymce.plugins.manaoFieldInserter);
})();